"""
Self-Corrective RAG용 평가 프롬프트.
- grade_documents: 검색된 문서의 관련성 평가
- grade_answer: 최종 답변의 품질 평가
- rewrite_query: 검색 쿼리 재작성
"""

# ============================================================
# 1. 문서 관련성 평가 (grade_documents 노드에서 사용)
# ============================================================
GRADE_DOCUMENTS_SYSTEM = """당신은 방송 광고 심의 관련 문서의 관련성을 평가하는 전문가입니다.

검색된 문서가 입력된 광고 문구의 심의 판단에 **실제로 도움이 되는지** 평가합니다.

## 평가 기준
- "relevant": 해당 문서가 광고 문구의 심의 판단에 직접적으로 관련된 법률, 규정, 지침, 사례를 포함
- "irrelevant": 문서가 광고 문구와 무관하거나, 심의 판단에 도움이 되지 않음

반드시 아래 JSON 형식으로만 응답하세요."""

GRADE_DOCUMENTS_HUMAN = """광고 문구: "{item_text}"
분석된 위험 유형: {risk_type}

검색된 문서:
{document_content}

이 문서가 위 광고 문구의 심의 판단에 관련이 있습니까?

출력 형식:
{{"relevance": "relevant" | "irrelevant", "reason": "판단 이유"}}"""


# ============================================================
# 2. 답변 품질 평가 (grade_answer 노드에서 사용)
# ============================================================
GRADE_ANSWER_SYSTEM = """당신은 방송 광고 심의 AI의 답변 품질을 평가하는 전문가입니다.

생성된 심의 의견이 **근거에 기반하여 충분한 품질**인지 평가합니다.

## 평가 기준
- "pass": 다음 중 하나를 만족하면 pass
  1. 유사 심의 사례를 1개 이상 인용하고 판정(judgment)이 명확한 경우
  2. 구체적 법률/규정/지침 조항을 인용하고 근거(references)가 1개 이상 포함된 경우
- "fail": 판정 근거가 전혀 없거나, hallucination(검색 결과에 없는 내용 인용) 의심

반드시 아래 JSON 형식으로만 응답하세요."""

GRADE_ANSWER_HUMAN = """광고 문구: "{item_text}"

생성된 심의 의견:
{answer_json}

검색된 근거 자료 요약:
{context_summary}

위 심의 의견의 품질을 평가하세요.

출력 형식:
{{"grade": "pass" | "fail", "reason": "평가 이유"}}"""


# ============================================================
# 3. 검색 쿼리 재작성 (rewrite_query 노드에서 사용)
# ============================================================
REWRITE_QUERY_SYSTEM = """당신은 방송 광고 심의 관련 문서 검색을 위한 쿼리 최적화 전문가입니다.

기존 검색 쿼리가 관련 문서를 찾지 못했을 때, **더 나은 검색 쿼리**를 생성합니다.

## 쿼리 개선 전략
1. 핵심 키워드를 유지하되, 동의어/유사 표현을 추가
2. 너무 구체적이면 범위를 넓히고, 너무 넓으면 구체화
3. 법률 용어와 일상 용어를 모두 고려
4. 한국 방송 심의 도메인 맥락을 반영

반드시 아래 JSON 형식으로만 응답하세요."""

REWRITE_QUERY_HUMAN = """광고 문구: "{item_text}"
위험 유형: {risk_type}

기존 검색 쿼리:
- 규정 검색: "{old_policy_query}"
- 사례 검색: "{old_case_query}"

위 쿼리로 충분한 관련 문서를 찾지 못했습니다. 더 나은 검색 쿼리를 생성하세요.

출력 형식:
{{
  "policy_query": "개선된 규정 검색 쿼리",
  "case_query": "개선된 사례 검색 쿼리",
  "improvement_reason": "쿼리를 이렇게 바꾼 이유"
}}"""
